<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPFS 上传和存储 CID</title>
</head>
<body>
    <div id="app">
        <h1>上传 .txt 文件并存储 CID</h1>

        <!-- 文件上传区域 -->
        <label for="fileInput">选择一个 .txt 文件：</label>
        <input type="file" @change="handleFileUpload" accept=".txt">
        <br><br>

        <!-- 上传按钮 -->
        <button @click="uploadToIPFS">上传到 IPFS</button>
        <br><br>

        <!-- 显示 CID -->
        <label for="cidOutput">文件的 CID：</label>
        <p>{{ cid || 'CID 将显示在这里' }}</p>

        <!-- 显示哈希摘要 -->
        <label for="digestOutput">文件的哈希摘要：</label>
        <p>{{ digest || '哈希摘要将显示在这里' }}</p>

        <!-- 区块链地址输入 -->
        <label for="userAddress">请输入您的地址：</label>
        <input type="text" v-model="userAddress" placeholder="0xYourAddress">
        <br><br>

        <!-- 存储 CID 到区块链按钮 -->
        <button @click="storeToBlockchain">存储 CID 到区块链</button>
    </div>

    <script src="./lib/vue.js"></script>
    <script src="../static/js/ipfs-upload.js"></script>

    <script>
        new Vue({
            el: '#app',
            data() {
                return {
                    file: null,
                    cid: '',
                    digest: '',
                    userAddress: ''
                };
            },
            methods: {
                handleFileUpload(event) {
                    this.file = event.target.files[0];
                },
                async uploadToIPFS() {
                    if (!this.file) {
                        alert('请选择一个文件');
                        return;
                    }
                    try {
                        // 调用 IPFS 上传文件的函数，并获取 CID 和哈希摘要
                        const { cid, digest } = await uploadToIPFS(this.file);
                        this.cid = cid;
                        this.digest = digest;
                    } catch (error) {
                        console.error('IPFS 上传失败:', error);
                    }
                },
                async storeToBlockchain() {
                    if (!this.cid || !this.userAddress) {
                        alert('请确保 CID 和区块链地址已填写');
                        return;
                    }
                    try {
                        // 存储 CID 到区块链的逻辑
                        await storeToBlockchain(this.cid, this.userAddress);
                        alert('CID 已存储到区块链');
                    } catch (error) {
                        console.error('存储到区块链失败:', error);
                    }
                }
            }
        });
    </script>
</body>
</html>
